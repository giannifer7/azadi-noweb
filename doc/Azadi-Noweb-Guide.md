
### Introduction to azadi-noweb

**azadi-noweb** is a literate programming tool that enables structured and modular file generation using file chunks. 
This guide explains the conventions and workflows to ensure consistent and secure file generation.

---

### General Structure and Conventions

#### File and Chunk Syntax

1. Files are defined as "chunks" using the following syntax:

   ```
   <[@file filepath]>=
   # filepath
   file content
   $$
   ```

2. Key rules for defining file chunks:

   - `@file` is a required keyword to indicate file chunks.
   - The first line of every chunk must be a comment containing the file path.
   - File paths must always be **relative** (e.g., `dir/subdir/file.ext`) and must not contain `..` to prevent path traversal.
   - The path separator is always `/`, even on Windows.

#### Using and Defining Chunks

- Chunks can be defined and reused as follows:

  ```
  <[chunk_name]>=
  chunk content
      <[another_chunk]>
  $$
  ```

- Chunks may include other chunks, and content is inserted with appropriate indentation.

- Chunks can be used before they are defined, allowing a top-down development approach.

#### File Naming for Artifacts

- Artifacts (the files generated by this workflow) must be named sequentially for organization and grouped to stay under 300 lines each:
  ```
  00-introduction.txt
  01-general-structure.txt
  02-docker-setup.txt
  ```

#### Rules for File Generation

1. **Unique Names**: Each chunk and file-chunk name must be globally unique.
2. **Complete Updates**: When an artifact is updated, the entire file must replace the original.
3. **Plain Text**: All artifacts must use plain text, not Markdown.
4. **Line Length**: Keep lines under 90 characters for readability.
5. **Line Limit**: Keep each artifact under 300 lines by grouping related file chunks.

---

### Example Artifacts

#### Artifact: `02-docker-setup.txt`

This artifact contains multiple Docker-related file chunks and functions, grouped logically.

```
<[@file packaging/scripts/docker/Builders.dockerfile]>=
# packaging/scripts/docker/Builders.dockerfile
FROM python:3.10-slim
WORKDIR /app
COPY requirements.txt .
RUN pip install -r requirements.txt
$$

<[@file packaging/scripts/docker/Helpers.sh]>=
# packaging/scripts/docker/Helpers.sh
<[build_function]>
<[cleanup_function]>
$$

<[build_function]>=
build() {
    echo "Building the Docker image..."
}
$$

<[cleanup_function]>=
cleanup() {
    echo "Cleaning up resources..."
}
$$
```

#### Artifact: `03-docker-extensions.txt`

```
<[@file packaging/scripts/docker/Extensions.sh]>=
# packaging/scripts/docker/Extensions.sh
<[extension_function]>
$$

<[extension_function]>=
extend() {
    echo "Adding extra functionality..."
}
$$
```

---

### Workflow Guidelines

1. **Top-Down Approach**: Use chunks before defining them, encouraging iterative refinement.
2. **Logical Grouping**: Group related chunks into a single artifact, staying under 300 lines.
3. **Interspersed Comments**: Add comments for clarity without breaking chunk syntax.
4. **Path Rules**: Ensure all file paths are relative and use `/` as the separator. Avoid `..` to prevent path traversal vulnerabilities.
5. **Update Policy**: When modifying artifacts, provide a complete replacement file for ease of extraction.
6. **Validation**: At the end of the process, confirm all chunks used in artifacts are defined.

---
